{
  "schema": "transaction",
  "version": "1.0",
  "description": "Schema for fraud detection transaction data",
  "fields": [
    {
      "name": "transaction_id",
      "type": "string",
      "required": true,
      "description": "Unique transaction identifier",
      "pattern": "^TXN[0-9]+$",
      "max_length": 20
    },
    {
      "name": "user_id",
      "type": "string", 
      "required": true,
      "description": "User identifier",
      "pattern": "^USR[0-9]+$",
      "max_length": 15
    },
    {
      "name": "merchant_id",
      "type": "string",
      "required": true,
      "description": "Merchant identifier", 
      "pattern": "^MRC[0-9]+$",
      "max_length": 15
    },
    {
      "name": "amount",
      "type": "float",
      "required": true,
      "description": "Transaction amount",
      "min_value": 0.01,
      "max_value": 100000.00
    },
    {
      "name": "currency",
      "type": "string",
      "required": true,
      "description": "Currency code",
      "allowed_values": ["USD", "EUR", "GBP", "CAD", "JPY", "AUD"],
      "max_length": 3
    },
    {
      "name": "timestamp",
      "type": "datetime",
      "required": true,
      "description": "Transaction timestamp",
      "format": "YYYY-MM-DD HH:MM:SS"
    },
    {
      "name": "payment_method",
      "type": "string",
      "required": true,
      "description": "Payment method used",
      "allowed_values": ["credit_card", "debit_card", "paypal", "apple_pay", "google_pay", "bank_transfer", "wire_transfer"],
      "max_length": 20
    },
    {
      "name": "country",
      "type": "string",
      "required": true,
      "description": "Country code",
      "pattern": "^[A-Z]{2}$",
      "max_length": 2
    },
    {
      "name": "ip_address",
      "type": "string",
      "required": true,
      "description": "IP address of transaction",
      "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}$",
      "max_length": 15
    },
    {
      "name": "device_id",
      "type": "string",
      "required": false,
      "description": "Device identifier",
      "pattern": "^DEV[0-9]+$",
      "max_length": 20
    },
    {
      "name": "is_fraud",
      "type": "integer",
      "required": true,
      "description": "Fraud label (0=legitimate, 1=fraud)",
      "allowed_values": [0, 1]
    }
  ],
  "constraints": [
    {
      "type": "unique",
      "fields": ["transaction_id"],
      "description": "Transaction ID must be unique"
    },
    {
      "type": "business_rule",
      "rule": "amount > 0",
      "description": "Transaction amount must be positive"
    },
    {
      "type": "business_rule", 
      "rule": "timestamp <= NOW()",
      "description": "Transaction timestamp cannot be in future"
    }
  ],
  "indexes": [
    {
      "name": "idx_transaction_id",
      "fields": ["transaction_id"],
      "type": "primary"
    },
    {
      "name": "idx_user_timestamp",
      "fields": ["user_id", "timestamp"],
      "type": "composite"
    },
    {
      "name": "idx_fraud_flag",
      "fields": ["is_fraud"],
      "type": "index"
    }
  ]
}
